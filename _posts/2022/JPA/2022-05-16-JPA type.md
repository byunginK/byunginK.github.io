---
layout: post
title: "JPA 값 타입"
date: 2022-05-16
categories: [JPA]
---

# 데이터 타입

### 엔티티 타입

- `@Entity`로 정의하는 객체
- 데이터가 변해도 식별자로 지속해서 추적 가능

### 값 타입

- 자바 기본 타입이나 객체
- 식별자가 없고 값만 있으므로 변경시 추적 불가

### 값 타입 분류

1. 기본값 (int, double, Integer, Long, String)
2. 임베디드
3. 컬렉션 값

## 임베디드 타입

- 새로운 값 타입을 직접 정의할 수 있음
- `@Embeddable`과 `@Embedded`사용

### 장점

- 재사용
- 높은 응집도
- 값 타입만의 의미 있는 메소드를 만들 수 있음 (객체 지향적)
- 생명주기는 엔티티에 의존

#### 사용

- 당하는 객체 클래스는 `@Embeddable`을 걸어주고 해당 객체를 가진 클래스는 `@Embedded`사용

#### 매핑

- 임베디드 타입을 사용하기 전과 후에 매핑하는 테이블은 같다.
- 객체와 테이블을 아주 세밀하게 매핑하는 것이 가능
- 중복은 에러가 난다.

### @AttributeOverride or @AttributeOverrides

- 속성 재정의
- 한 엔티티에서 같은 값타입 사용시
- 컬럼명이 중복
- 위의 어노테이션을 이용해서 컬럼 속성 재정의

## 값 타입과 불변 객체

- 값 타입 공유 참조 : 임베디드 타입은 여러 엔티티에서 공유하면 위험
- 영속성이 겹쳐서 임베디드에서 set을 했을때 참조하고 있는 모든 내용이 바뀐다.

- _따라서 값을 복사해서 사용해야함_ (객체를 하나 더 생성해서 값을 넣고 거기서 set을 적용)

### 값 타입의 한계

- 직접 정의한 값 타입은 기본 타입이 아니라 객체 타입이다.
- 자바 기본 타입에 값을 대입하면 값을 복사한다.
- 객체 타입은 참조값을 직접 대입하는것을 막을 방법이 없다.
- 객체의 공유 참조를 피할 수 없다.

### 해결방안

- 객체 타입을 수정할 수 없게 만들어야한다.
- 값 타입은 불변 객체로 설계
- 불변 객체 : 생성 시점 이후 절대 값을 변경할 수 없는 객체
- 생성자로만 값을 설정하고 setter를 만들지 않음
